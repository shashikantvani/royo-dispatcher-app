{"version":3,"sources":["useTabbedFlashListHeader.tsx"],"names":["useRenderFlashListHeader","props","contentBackgroundColor","innerScrollHeight","onMomentumScrollEnd","onScroll","onScrollEndDrag","parallaxHeight","scrollHeight","scrollValue","scrollViewRef","backgroundColor","backgroundImage","foregroundImage","hasBorderRadius","tabsContainerBackgroundColor","title","titleStyle","titleTestID","horizontalScrollValue","onHorizontalPagerScroll","e","value","contentOffset","x","renderHeader","React","useCallback","useTabbedFlashListHeader","stickyHeaderIndices","useState","activeSection","setActiveSection","ignoreViewabilityItemsChangedEvent","onViewableItemsChanged","viewableItems","length","index","newActiveSection","i","firstIdx","secondIdx","goToSection","sectionIndex","current","scrollToIndex","animated","viewPosition","viewOffset","onMomentumScrollEndInternal","debouncedIgnoreViewabilityItemsChangedCallback","onScrollInternal","Platform","OS","renderTabs","activeTab","onTabPressed"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport type { FlashList, ViewToken } from '@shopify/flash-list';\nimport * as React from 'react';\nimport type { NativeScrollEvent } from 'react-native';\nimport { Platform } from 'react-native';\nimport { runOnJS, useSharedValue, useWorkletCallback } from 'react-native-reanimated';\n\nimport { HeaderWrapper } from '../../common/components/HeaderWrapper';\nimport { usePredefinedFlashListHeader } from '../../common/hooks/usePredefinedFlashListHeader';\nimport { debounce } from '../../common/utils/debounce';\nimport { isNotEmpty } from '../../common/utils/isNotEmpty';\nimport type { TabbedHeaderFlashListProps } from '../TabbedHeaderProps';\nimport { Foreground } from '../components/HeaderForeground';\n\nimport { useRenderTabs } from './useRenderTabs';\n\nfunction useRenderFlashListHeader<T extends FlashList<any>>(\n  props: TabbedHeaderFlashListProps<any>\n) {\n  const {\n    contentBackgroundColor,\n    innerScrollHeight,\n    onMomentumScrollEnd,\n    onScroll,\n    onScrollEndDrag,\n    parallaxHeight,\n    scrollHeight,\n    scrollValue,\n    scrollViewRef,\n  } = usePredefinedFlashListHeader<T>(props);\n  const {\n    backgroundColor,\n    backgroundImage,\n    foregroundImage,\n    hasBorderRadius,\n    tabsContainerBackgroundColor,\n    title,\n    titleStyle,\n    titleTestID,\n  } = props;\n  const horizontalScrollValue = useSharedValue(0);\n  const onHorizontalPagerScroll = useWorkletCallback((e: NativeScrollEvent) => {\n    horizontalScrollValue.value = e.contentOffset.x;\n  }, []);\n\n  const renderHeader = React.useCallback(() => {\n    return (\n      <HeaderWrapper\n        backgroundColor={backgroundColor}\n        backgroundImage={backgroundImage}\n        contentBackgroundColor={contentBackgroundColor}\n        hasBorderRadius={hasBorderRadius}\n        parallaxHeight={parallaxHeight}\n        scrollHeight={scrollHeight}\n        scrollValue={scrollValue}\n        tabsContainerBackgroundColor={tabsContainerBackgroundColor}>\n        <Foreground\n          height={parallaxHeight}\n          scrollValue={scrollValue}\n          foregroundImage={foregroundImage}\n          title={title}\n          titleStyle={titleStyle}\n          titleTestID={titleTestID}\n        />\n      </HeaderWrapper>\n    );\n  }, [\n    backgroundColor,\n    backgroundImage,\n    contentBackgroundColor,\n    foregroundImage,\n    hasBorderRadius,\n    parallaxHeight,\n    scrollHeight,\n    scrollValue,\n    tabsContainerBackgroundColor,\n    title,\n    titleStyle,\n    titleTestID,\n  ]);\n\n  return {\n    innerScrollHeight,\n    horizontalScrollValue,\n    onHorizontalPagerScroll,\n    onMomentumScrollEnd,\n    onScroll,\n    onScrollEndDrag,\n    renderHeader,\n    scrollHeight,\n    scrollValue,\n    scrollViewRef,\n  };\n}\n\nexport function useTabbedFlashListHeader<ItemT, T extends FlashList<ItemT> = FlashList<ItemT>>(\n  props: TabbedHeaderFlashListProps<ItemT>\n) {\n  const {\n    innerScrollHeight,\n    horizontalScrollValue,\n    onMomentumScrollEnd,\n    onScroll,\n    onScrollEndDrag,\n    renderHeader,\n    scrollValue,\n    scrollViewRef,\n  } = useRenderFlashListHeader<T>(props);\n  const { stickyHeaderIndices = [], backgroundColor, tabsContainerBackgroundColor } = props;\n  const [activeSection, setActiveSection] = React.useState(0);\n  const ignoreViewabilityItemsChangedEvent = useSharedValue(false);\n  const onViewableItemsChanged = React.useCallback(\n    ({ viewableItems }: { viewableItems: ViewToken[]; changed: ViewToken[] }) => {\n      if (\n        !viewableItems.length ||\n        ignoreViewabilityItemsChangedEvent.value ||\n        !isNotEmpty(viewableItems[0].index)\n      ) {\n        return;\n      }\n\n      let newActiveSection: number | undefined;\n\n      for (let i = 0; i < stickyHeaderIndices.length; i++) {\n        const firstIdx = stickyHeaderIndices[i];\n\n        if (i === stickyHeaderIndices.length - 1) {\n          if (viewableItems[0].index >= firstIdx) {\n            newActiveSection = i;\n            i = stickyHeaderIndices.length;\n          }\n        } else {\n          const secondIdx = stickyHeaderIndices[i + 1];\n\n          if (viewableItems[0].index >= firstIdx && viewableItems[0].index < secondIdx) {\n            newActiveSection = i;\n            i = stickyHeaderIndices.length;\n          }\n        }\n      }\n\n      if (typeof newActiveSection === 'number') {\n        setActiveSection(newActiveSection);\n      }\n    },\n    [ignoreViewabilityItemsChangedEvent, stickyHeaderIndices]\n  );\n  const goToSection = React.useCallback(\n    (sectionIndex: number) => {\n      ignoreViewabilityItemsChangedEvent.value = true;\n      scrollViewRef.current?.scrollToIndex({\n        animated: true,\n        index: stickyHeaderIndices[sectionIndex],\n        viewPosition: 0,\n        viewOffset: 0,\n      });\n      setActiveSection(sectionIndex);\n    },\n    [ignoreViewabilityItemsChangedEvent, scrollViewRef, stickyHeaderIndices]\n  );\n  const onMomentumScrollEndInternal = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      ignoreViewabilityItemsChangedEvent.value = false;\n      onMomentumScrollEnd?.(e);\n    },\n    [onMomentumScrollEnd]\n  );\n  const debouncedIgnoreViewabilityItemsChangedCallback = debounce(() => {\n    ignoreViewabilityItemsChangedEvent.value = false;\n  }, 100);\n  const onScrollInternal = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      if (Platform.OS === 'web') {\n        // On web there is no onMomentumScrollEnd\n        runOnJS(debouncedIgnoreViewabilityItemsChangedCallback)();\n      }\n\n      onScroll?.(e);\n    },\n    [onScroll]\n  );\n\n  const renderTabs = useRenderTabs({\n    ...props,\n    activeTab: activeSection,\n    horizontalScrollValue,\n    onTabPressed: goToSection,\n    tabsContainerBackgroundColor: tabsContainerBackgroundColor ?? backgroundColor,\n  });\n\n  return {\n    goToSection,\n    innerScrollHeight,\n    onMomentumScrollEnd: onMomentumScrollEndInternal,\n    onScroll: onScrollInternal,\n    onScrollEndDrag,\n    onViewableItemsChanged,\n    renderHeader,\n    renderTabs,\n    scrollValue,\n    scrollViewRef,\n  };\n}\n"]}