{"version":3,"sources":["useStickyHeaderFlashListScrollProps.ts"],"names":["VELOCITY_THRESHOLD","useStickyHeaderFlashListScrollProps","props","responsiveHeight","headerHeight","onMomentumScrollEnd","onScroll","onScrollEndDrag","onTopReached","parallaxHeight","snapStartThreshold","snapStopThreshold","snapToEdge","scrollValue","scrollViewRef","onTopReachedRef","onTopReachedWasCalled","current","maybeTopReached","value","scrollHeight","Math","max","snapToTop","scrollToOffset","animated","offset","snapToBottom","onSnapToEdge","e","scrollToHeight","snapToEdgeThreshold","currentVal","velocity","y","dragsToTop","dragsToBottom","dragsQuickToBottom","dragsQuickToTop","isUnderSnapToEdgeThresholdAndDragIsSlow","isUnderSnapToEdgeThresholdAndDragIsQuick","isOverSnapToEdgeThresholdAndDragIsSlow","isOverSnapToEdgeThresholdAndDragIsQuick","onMomentumScrollEndInternal","onScrollEndDragInternal","Platform","OS","abs","onScrollInternal","contentOffset"],"mappings":"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","sourcesContent":["import type { FlashList } from '@shopify/flash-list';\nimport { useCallback, useEffect, useRef } from 'react';\nimport type { NativeScrollEvent } from 'react-native';\nimport { Platform } from 'react-native';\nimport {\n  runOnJS,\n  useAnimatedReaction,\n  useAnimatedRef,\n  useSharedValue,\n  useWorkletCallback,\n} from 'react-native-reanimated';\n\nimport { useResponsiveSize } from '../hooks/useResponsiveSize';\n\nimport type { StickyHeaderSharedProps, StickyHeaderSnapProps } from './StickyHeaderProps';\n\nconst VELOCITY_THRESHOLD = 7;\n\n// FIXME: unknown does not work here :/\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function useStickyHeaderFlashListScrollProps<T extends FlashList<any> = FlashList<any>>(\n  props: StickyHeaderSharedProps & StickyHeaderSnapProps\n) {\n  const { responsiveHeight } = useResponsiveSize();\n\n  const {\n    headerHeight = 100,\n    onMomentumScrollEnd,\n    onScroll,\n    onScrollEndDrag,\n    onTopReached,\n    parallaxHeight = responsiveHeight(53),\n    snapStartThreshold,\n    snapStopThreshold,\n    snapToEdge = true,\n  } = props;\n\n  const scrollValue = useSharedValue(0);\n\n  const scrollViewRef = useAnimatedRef<T>();\n\n  const onTopReachedRef = useRef(onTopReached);\n  const onTopReachedWasCalled = useRef(false);\n\n  useEffect(() => {\n    onTopReachedRef.current = onTopReached;\n  }, [onTopReached]);\n\n  function maybeTopReached(value: number) {\n    if (value <= 0) {\n      if (!onTopReachedWasCalled.current && onTopReachedRef.current) {\n        onTopReachedRef.current();\n        onTopReachedWasCalled.current = true;\n      }\n    } else {\n      onTopReachedWasCalled.current = false;\n    }\n  }\n\n  useAnimatedReaction(\n    () => scrollValue.value,\n    (value) => {\n      runOnJS(maybeTopReached)(value);\n    },\n    [scrollValue]\n  );\n\n  const scrollHeight = Math.max(parallaxHeight, headerHeight * 2);\n\n  const snapToTop = useCallback(() => {\n    scrollViewRef.current?.scrollToOffset({ animated: true, offset: 0 });\n  }, [scrollViewRef]);\n\n  const snapToBottom = useCallback(() => {\n    scrollViewRef.current?.scrollToOffset({ animated: true, offset: scrollHeight });\n  }, [scrollHeight, scrollViewRef]);\n\n  const onSnapToEdge = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      const scrollToHeight = snapStopThreshold ?? scrollHeight;\n      const snapToEdgeThreshold = snapStartThreshold ?? scrollHeight / 2;\n\n      const currentVal = scrollValue.value;\n      const velocity = e.velocity?.y ?? 0;\n\n      const dragsToTop = velocity >= 0;\n      const dragsToBottom = !dragsToTop;\n      const dragsQuickToBottom = dragsToBottom && velocity <= -VELOCITY_THRESHOLD;\n      const dragsQuickToTop = dragsToTop && velocity >= VELOCITY_THRESHOLD;\n\n      const isUnderSnapToEdgeThresholdAndDragIsSlow =\n        currentVal > 0 && currentVal < snapToEdgeThreshold && !dragsQuickToBottom;\n      const isUnderSnapToEdgeThresholdAndDragIsQuick =\n        currentVal >= snapToEdgeThreshold / 2 &&\n        currentVal < snapToEdgeThreshold &&\n        dragsQuickToBottom;\n      const isOverSnapToEdgeThresholdAndDragIsSlow =\n        currentVal >= snapToEdgeThreshold && currentVal < scrollToHeight && !dragsQuickToTop;\n      const isOverSnapToEdgeThresholdAndDragIsQuick =\n        currentVal >= snapToEdgeThreshold && currentVal < scrollToHeight / 2 && dragsQuickToTop;\n\n      if (snapToEdge) {\n        // TODO: when react-native-web will support onMomentumScrollEnd & onScrollEndDrag events\n        // handle web snap scroll\n        if (isUnderSnapToEdgeThresholdAndDragIsSlow || isOverSnapToEdgeThresholdAndDragIsQuick) {\n          runOnJS(snapToTop)();\n        } else if (\n          isOverSnapToEdgeThresholdAndDragIsSlow ||\n          isUnderSnapToEdgeThresholdAndDragIsQuick\n        ) {\n          runOnJS(snapToBottom)();\n        }\n      }\n    },\n    [\n      snapStartThreshold,\n      snapStopThreshold,\n      snapToBottom,\n      snapToTop,\n      snapToEdge,\n      scrollHeight,\n      scrollValue,\n    ]\n  );\n\n  const onMomentumScrollEndInternal = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      onMomentumScrollEnd?.(e);\n      onSnapToEdge(e);\n    },\n    [onMomentumScrollEnd, onSnapToEdge]\n  );\n\n  const onScrollEndDragInternal = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      onScrollEndDrag?.(e);\n      if (Platform.OS === 'android' || Math.abs(e.velocity?.y ?? 0) > 0) {\n        return;\n      }\n\n      onSnapToEdge(e);\n    },\n    [onScrollEndDrag, onSnapToEdge]\n  );\n\n  const onScrollInternal = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      scrollValue.value = e.contentOffset.y;\n      onScroll?.(e);\n    },\n    [onScroll]\n  );\n\n  return {\n    onMomentumScrollEnd: onMomentumScrollEndInternal,\n    onScroll: onScrollInternal,\n    onScrollEndDrag: onScrollEndDragInternal,\n    scrollHeight,\n    scrollValue,\n    scrollViewRef,\n  };\n}\n"]}