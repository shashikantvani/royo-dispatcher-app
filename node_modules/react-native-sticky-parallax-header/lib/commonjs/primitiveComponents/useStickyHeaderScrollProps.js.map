{"version":3,"sources":["useStickyHeaderScrollProps.ts"],"names":["VELOCITY_THRESHOLD","useStickyHeaderScrollProps","props","responsiveHeight","headerHeight","onMomentumScrollEnd","onScroll","onScrollEndDrag","onTopReached","parallaxHeight","snapStartThreshold","snapStopThreshold","snapToEdge","scrollValue","scrollViewRef","onTopReachedRef","onTopReachedWasCalled","current","maybeTopReached","value","scrollHeight","Math","max","onSnapToEdge","e","scrollToHeight","snapToEdgeThreshold","currentVal","velocity","y","dragsToTop","dragsToBottom","dragsQuickToBottom","dragsQuickToTop","isUnderSnapToEdgeThresholdAndDragIsSlow","isUnderSnapToEdgeThresholdAndDragIsQuick","isOverSnapToEdgeThresholdAndDragIsSlow","isOverSnapToEdgeThresholdAndDragIsQuick","onMomentumScrollEndInternal","onScrollEndDragInternal","Platform","OS","abs","onScrollInternal","contentOffset"],"mappings":"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","sourcesContent":["import { useEffect, useRef } from 'react';\nimport type { FlatList, NativeScrollEvent, ScrollView, SectionList } from 'react-native';\nimport { Platform } from 'react-native';\nimport {\n  runOnJS,\n  scrollTo,\n  useAnimatedReaction,\n  useAnimatedRef,\n  useSharedValue,\n  useWorkletCallback,\n} from 'react-native-reanimated';\n\nimport { useResponsiveSize } from '../hooks/useResponsiveSize';\n\nimport type { StickyHeaderSharedProps, StickyHeaderSnapProps } from './StickyHeaderProps';\n\n// FIXME: unknown does not work here :/\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type ScrollComponent = ScrollView | FlatList<any> | SectionList<any, any>;\n\nconst VELOCITY_THRESHOLD = 7;\n\nexport function useStickyHeaderScrollProps<T extends ScrollComponent>(\n  props: StickyHeaderSharedProps & StickyHeaderSnapProps\n) {\n  const { responsiveHeight } = useResponsiveSize();\n\n  const {\n    headerHeight = 100,\n    onMomentumScrollEnd,\n    onScroll,\n    onScrollEndDrag,\n    onTopReached,\n    parallaxHeight = responsiveHeight(53),\n    snapStartThreshold,\n    snapStopThreshold,\n    snapToEdge = true,\n  } = props;\n\n  const scrollValue = useSharedValue(0);\n\n  const scrollViewRef = useAnimatedRef<T>();\n\n  const onTopReachedRef = useRef(onTopReached);\n  const onTopReachedWasCalled = useRef(false);\n\n  useEffect(() => {\n    onTopReachedRef.current = onTopReached;\n  }, [onTopReached]);\n\n  function maybeTopReached(value: number) {\n    if (value <= 0) {\n      if (!onTopReachedWasCalled.current && onTopReachedRef.current) {\n        onTopReachedRef.current();\n        onTopReachedWasCalled.current = true;\n      }\n    } else {\n      onTopReachedWasCalled.current = false;\n    }\n  }\n\n  useAnimatedReaction(\n    () => scrollValue.value,\n    (value) => {\n      runOnJS(maybeTopReached)(value);\n    },\n    [scrollValue]\n  );\n\n  const scrollHeight = Math.max(parallaxHeight, headerHeight * 2);\n\n  const onSnapToEdge = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      const scrollToHeight = snapStopThreshold ?? scrollHeight;\n      const snapToEdgeThreshold = snapStartThreshold ?? scrollHeight / 2;\n\n      const currentVal = scrollValue.value;\n      const velocity = e.velocity?.y ?? 0;\n\n      const dragsToTop = velocity >= 0;\n      const dragsToBottom = !dragsToTop;\n      const dragsQuickToBottom = dragsToBottom && velocity <= -VELOCITY_THRESHOLD;\n      const dragsQuickToTop = dragsToTop && velocity >= VELOCITY_THRESHOLD;\n\n      const isUnderSnapToEdgeThresholdAndDragIsSlow =\n        currentVal > 0 && currentVal < snapToEdgeThreshold && !dragsQuickToBottom;\n      const isUnderSnapToEdgeThresholdAndDragIsQuick =\n        currentVal >= snapToEdgeThreshold / 2 &&\n        currentVal < snapToEdgeThreshold &&\n        dragsQuickToBottom;\n      const isOverSnapToEdgeThresholdAndDragIsSlow =\n        currentVal >= snapToEdgeThreshold && currentVal < scrollToHeight && !dragsQuickToTop;\n      const isOverSnapToEdgeThresholdAndDragIsQuick =\n        currentVal >= snapToEdgeThreshold && currentVal < scrollToHeight / 2 && dragsQuickToTop;\n\n      if (snapToEdge) {\n        // TODO: when react-native-web will support onMomentumScrollEnd & onScrollEndDrag events\n        // handle web snap scroll\n        if (isUnderSnapToEdgeThresholdAndDragIsSlow || isOverSnapToEdgeThresholdAndDragIsQuick) {\n          scrollTo(scrollViewRef, 0, 0, true);\n        } else if (\n          isOverSnapToEdgeThresholdAndDragIsSlow ||\n          isUnderSnapToEdgeThresholdAndDragIsQuick\n        ) {\n          scrollTo(scrollViewRef, 0, scrollHeight, true);\n        }\n      }\n    },\n    [snapStartThreshold, snapStopThreshold, scrollHeight, scrollValue]\n  );\n\n  const onMomentumScrollEndInternal = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      onMomentumScrollEnd?.(e);\n      onSnapToEdge(e);\n    },\n    [onMomentumScrollEnd, onSnapToEdge]\n  );\n\n  const onScrollEndDragInternal = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      onScrollEndDrag?.(e);\n      if (Platform.OS === 'android' || Math.abs(e.velocity?.y ?? 0) > 0) {\n        return;\n      }\n\n      onSnapToEdge(e);\n    },\n    [onScrollEndDrag, onSnapToEdge]\n  );\n\n  const onScrollInternal = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      scrollValue.value = e.contentOffset.y;\n      onScroll?.(e);\n    },\n    [onScroll]\n  );\n\n  return {\n    onMomentumScrollEnd: onMomentumScrollEndInternal,\n    onScroll: onScrollInternal,\n    onScrollEndDrag: onScrollEndDragInternal,\n    scrollHeight,\n    scrollValue,\n    scrollViewRef,\n  };\n}\n"]}