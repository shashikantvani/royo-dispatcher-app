{"version":3,"sources":["useTabbedHeader.tsx"],"names":["React","Platform","runOnJS","useSharedValue","useWorkletCallback","HeaderWrapper","usePredefinedHeader","debounce","Foreground","useRenderTabs","useRenderHeader","props","contentBackgroundColor","innerScrollHeight","onMomentumScrollEnd","onScroll","onScrollEndDrag","parallaxHeight","scrollHeight","scrollValue","scrollViewRef","backgroundColor","backgroundImage","foregroundImage","hasBorderRadius","tabsContainerBackgroundColor","title","titleStyle","titleTestID","horizontalScrollValue","onHorizontalPagerScroll","e","value","contentOffset","x","renderHeader","useCallback","useTabbedHeaderPager","initialPage","currentPage","setCurrentPage","useState","goToPage","pageNumber","prev","renderTabs","activeTab","onTabPressed","useTabbedHeaderList","ignoreViewabilityItemsChangedEvent","onMomentumScrollEndInternal","debouncedIgnoreViewabilityItemsChangedCallback","onScrollInternal","OS","sections","activeSection","setActiveSection","goToSection","sectionIndex","current","scrollToLocation","animated","itemIndex","viewPosition","onViewableItemsChanged","viewableItems","length","newActiveSection","findIndex","section","key"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport type { NativeScrollEvent, ScrollView, SectionList, ViewToken } from 'react-native';\nimport { Platform } from 'react-native';\nimport { runOnJS, useSharedValue, useWorkletCallback } from 'react-native-reanimated';\n\nimport type { ScrollComponent } from '../../common/SharedProps';\nimport { HeaderWrapper } from '../../common/components/HeaderWrapper';\nimport { usePredefinedHeader } from '../../common/hooks/usePredefinedHeader';\nimport { debounce } from '../../common/utils/debounce';\nimport type { TabbedHeaderListProps, TabbedHeaderPagerProps } from '../TabbedHeaderProps';\nimport { Foreground } from '../components/HeaderForeground';\n\nimport { useRenderTabs } from './useRenderTabs';\n\nfunction useRenderHeader<T extends ScrollComponent>(props: TabbedHeaderPagerProps) {\n  const {\n    contentBackgroundColor,\n    innerScrollHeight,\n    onMomentumScrollEnd,\n    onScroll,\n    onScrollEndDrag,\n    parallaxHeight,\n    scrollHeight,\n    scrollValue,\n    scrollViewRef,\n  } = usePredefinedHeader<T>(props);\n  const {\n    backgroundColor,\n    backgroundImage,\n    foregroundImage,\n    hasBorderRadius,\n    tabsContainerBackgroundColor,\n    title,\n    titleStyle,\n    titleTestID,\n  } = props;\n  const horizontalScrollValue = useSharedValue(0);\n  const onHorizontalPagerScroll = useWorkletCallback((e: NativeScrollEvent) => {\n    horizontalScrollValue.value = e.contentOffset.x;\n  }, []);\n\n  const renderHeader = React.useCallback(() => {\n    return (\n      <HeaderWrapper\n        backgroundColor={backgroundColor}\n        backgroundImage={backgroundImage}\n        contentBackgroundColor={contentBackgroundColor}\n        hasBorderRadius={hasBorderRadius}\n        parallaxHeight={parallaxHeight}\n        scrollHeight={scrollHeight}\n        scrollValue={scrollValue}\n        tabsContainerBackgroundColor={tabsContainerBackgroundColor}>\n        <Foreground\n          height={parallaxHeight}\n          scrollValue={scrollValue}\n          foregroundImage={foregroundImage}\n          title={title}\n          titleStyle={titleStyle}\n          titleTestID={titleTestID}\n        />\n      </HeaderWrapper>\n    );\n  }, [\n    backgroundColor,\n    backgroundImage,\n    contentBackgroundColor,\n    foregroundImage,\n    hasBorderRadius,\n    parallaxHeight,\n    scrollHeight,\n    scrollValue,\n    tabsContainerBackgroundColor,\n    title,\n    titleStyle,\n    titleTestID,\n  ]);\n\n  return {\n    innerScrollHeight,\n    horizontalScrollValue,\n    onHorizontalPagerScroll,\n    onMomentumScrollEnd,\n    onScroll,\n    onScrollEndDrag,\n    renderHeader,\n    scrollHeight,\n    scrollValue,\n    scrollViewRef,\n  };\n}\n\nexport function useTabbedHeaderPager(props: TabbedHeaderPagerProps) {\n  const {\n    innerScrollHeight,\n    horizontalScrollValue,\n    onHorizontalPagerScroll,\n    onMomentumScrollEnd,\n    onScroll,\n    onScrollEndDrag,\n    renderHeader,\n    scrollHeight,\n    scrollValue,\n    scrollViewRef,\n  } = useRenderHeader<ScrollView>(props);\n  const { backgroundColor, initialPage, tabsContainerBackgroundColor } = props;\n  const [currentPage, setCurrentPage] = React.useState(initialPage ?? 0);\n\n  const goToPage = React.useCallback((pageNumber: number) => {\n    setCurrentPage((prev) => {\n      if (prev !== pageNumber) {\n        return pageNumber;\n      }\n\n      return prev;\n    });\n  }, []);\n\n  const renderTabs = useRenderTabs({\n    ...props,\n    activeTab: currentPage,\n    horizontalScrollValue,\n    onTabPressed: goToPage,\n    tabsContainerBackgroundColor: tabsContainerBackgroundColor ?? backgroundColor,\n  });\n\n  return {\n    currentPage,\n    goToPage,\n    innerScrollHeight,\n    onHorizontalPagerScroll,\n    onMomentumScrollEnd,\n    onScroll,\n    onScrollEndDrag,\n    renderHeader,\n    renderTabs,\n    scrollHeight,\n    scrollValue,\n    scrollViewRef,\n    setCurrentPage,\n  };\n}\n\nexport function useTabbedHeaderList<\n  ItemT,\n  SectionT,\n  T extends SectionList<ItemT, SectionT> = SectionList<ItemT, SectionT>\n>(props: TabbedHeaderListProps<ItemT, SectionT>) {\n  const ignoreViewabilityItemsChangedEvent = useSharedValue(false);\n  const {\n    innerScrollHeight,\n    horizontalScrollValue,\n    onMomentumScrollEnd,\n    onScroll,\n    onScrollEndDrag,\n    renderHeader,\n    scrollValue,\n    scrollViewRef,\n  } = useRenderHeader<T>(props);\n  const onMomentumScrollEndInternal = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      ignoreViewabilityItemsChangedEvent.value = false;\n      onMomentumScrollEnd?.(e);\n    },\n    [onMomentumScrollEnd]\n  );\n  const debouncedIgnoreViewabilityItemsChangedCallback = debounce(() => {\n    ignoreViewabilityItemsChangedEvent.value = false;\n  }, 100);\n  const onScrollInternal = useWorkletCallback(\n    (e: NativeScrollEvent) => {\n      if (Platform.OS === 'web') {\n        // On web there is no onMomentumScrollEnd\n        runOnJS(debouncedIgnoreViewabilityItemsChangedCallback)();\n      }\n\n      onScroll?.(e);\n    },\n    [onScroll]\n  );\n\n  const { backgroundColor, sections, tabsContainerBackgroundColor } = props;\n\n  const [activeSection, setActiveSection] = React.useState(0);\n\n  const goToSection = React.useCallback((sectionIndex: number) => {\n    ignoreViewabilityItemsChangedEvent.value = true;\n    scrollViewRef.current?.scrollToLocation({\n      animated: true,\n      itemIndex: 0,\n      sectionIndex,\n      viewPosition: 0,\n    });\n    setActiveSection(sectionIndex);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  const onViewableItemsChanged = React.useCallback(\n    ({ viewableItems }: { viewableItems: ViewToken[]; changed: ViewToken[] }) => {\n      if (!viewableItems.length || ignoreViewabilityItemsChangedEvent.value) {\n        return;\n      }\n\n      const newActiveSection = sections.findIndex(\n        (section) => section.key === viewableItems[0].section?.key\n      );\n\n      if (newActiveSection !== -1) {\n        setActiveSection(newActiveSection);\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [sections]\n  );\n\n  const renderTabs = useRenderTabs({\n    ...props,\n    activeTab: activeSection,\n    horizontalScrollValue,\n    onTabPressed: goToSection,\n    tabsContainerBackgroundColor: tabsContainerBackgroundColor ?? backgroundColor,\n  });\n\n  return {\n    goToSection,\n    innerScrollHeight,\n    onMomentumScrollEnd: onMomentumScrollEndInternal,\n    onScroll: onScrollInternal,\n    onScrollEndDrag,\n    onViewableItemsChanged,\n    renderHeader,\n    renderTabs,\n    scrollValue,\n    scrollViewRef,\n  };\n}\n"]}